new_geo      = "CED_NAME_2021",
year=2021)
original_geo = "SA1_CODE_2021"
list_proportions(original_geo)
chileans <- geo_aggregate(original_data = chileans_sa1,
values_col = "Value",
original_geo = "SA1_NAME_2021",
new_geo      = "CED_NAME_2021",
year=2021)
chileans_sa2 <- auscensus::get_census_summary(table_number= "09",
selected_years = "2021",
geo_structure = "SA2",
geo_unit_codes =     attr$SA1_CODE_2021,
attribute = list(Chileans=c("Persons_chile_total")))
chileans <- geo_aggregate(original_data = chileans_sa1,
values_col = "Value",
original_geo = "SA2_NAME_2021",
new_geo      = "CED_NAME_2021",
year=2021)
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_NAME_2021",
new_geo      = "CED_NAME_2021",
year=2021)
original_data = chileans_sa2
values_col = "Value"
original_geo = "SA2_NAME_2021"
new_geo      = "CED_NAME_2021
year=2021
correspondence_table <- list_structure(year=year) |>
select(any_of(c("id",original_geo,new_geo)))
correspondence_table <- list_structure(year=year) |>
select(any_of(c("id",original_geo,new_geo)))
proportions_manual
if(!is.null(proportions_manual)){
proportions_prop <- colnames(proportions_manual)[!(colnames(proportions_manual) %in% c(original_geo,new_geo))]
proportions_manual <- proportions_manual |>
rename("prop"=proportions_prop)
correspondence_table <- correspondence_table |>
anti_join(proportions_manual,by=c(original_geo,new_geo)) |>
bind_rows(proportions_manual)
}
if(!is.null(proportions_manual)){
proportions_prop <- colnames(proportions_manual)[!(colnames(proportions_manual) %in% c(original_geo,new_geo))]
proportions_manual <- proportions_manual |>
rename("prop"=proportions_prop)
correspondence_table <- correspondence_table |>
anti_join(proportions_manual,by=c(original_geo,new_geo)) |>
bind_rows(proportions_manual)
}
proportions_manual=NULL
is.null(proportions_manual)
if(!is.null(proportions_manual)){
proportions_prop <- colnames(proportions_manual)[!(colnames(proportions_manual) %in% c(original_geo,new_geo))]
proportions_manual <- proportions_manual |>
rename("prop"=proportions_prop)
correspondence_table <- correspondence_table |>
anti_join(proportions_manual,by=c(original_geo,new_geo)) |>
bind_rows(proportions_manual)
}
year_num <- as.double(year)
results <-       original_data |>
rename(!!"Value":=any_of(c(values_col)))        |>
left_join(correspondence_table,by=original_geo) |>
select(-any_of(c(original_geo)))                |>
group_by(across(c(new_geo,grouping_col)))        |>
summarise(Value=sum(.data$Value*.data$prop,na.rm = TRUE),.groups = "drop") |>
rename(!!values_col:="Value")
correspondence_table <- list_structure(year=year) |>
select(any_of(c("id",original_geo,new_geo)))
original_geo
new_geo
new_geo      = "CED_NAME_2021"
correspondence_table <- correspondence_table |>
left_join(proportions_table,by=c("id",original_geo)) |>
group_by(across(c(original_geo,new_geo))) |>
summarise(across(c("prop"), ~ sum(.x,na.rm=TRUE)),.groups = "drop")
correspondence_table <- list_structure(year=year) |>
select(any_of(c("id",original_geo,new_geo)))
proportions_table <-   list_proportions(original_geo) |>
collect()  |>
select("id","geo_col","prop") |>
rename(!!original_geo := "geo_col")
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_CODE_2021",
new_geo      = "CED_NAME_2021",
year=2021)
correspondence_table <- list_structure(year=year) |>
select(any_of(c("id",original_geo,new_geo)))
proportions_table <-   list_proportions(original_geo) |>
collect()  |>
select("id","geo_col","prop") |>
rename(!!original_geo := "geo_col")
original_geo = "SA2_CODE_2021"
proportions_table <-   list_proportions(original_geo) |>
collect()  |>
select("id","geo_col","prop") |>
rename(!!original_geo := "geo_col")
correspondence_table <- correspondence_table |>
left_join(proportions_table,by=c("id",original_geo)) |>
group_by(across(c(original_geo,new_geo))) |>
summarise(across(c("prop"), ~ sum(.x,na.rm=TRUE)),.groups = "drop")
original_geo
proportions_table
correspondence_table
orrespondence_table |>
left_join(proportions_table,by=c("id",original_geo))
correspondence_table |>
left_join(proportions_table,by=c("id",original_geo))
correspondence_table
original_geo = "SA2_NAME_2021"
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_NAME_2021",
new_geo      = "CED_NAME_2021",
year=2021)
correspondence_table <- list_structure(year=year) |>
select(any_of(c("id",original_geo,new_geo)))
proportions_table <-   list_proportions(original_geo) |>
collect()  |>
select("id","geo_col","prop") |>
rename(!!original_geo := "geo_col")
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_CODE_2021",
new_geo      = "CED_NAME_2021",
year=2021)
original_geo = "SA2_CODE_2021"
if(!is.null(proportions_manual)){
proportions_prop <- colnames(proportions_manual)[!(colnames(proportions_manual) %in% c(original_geo,new_geo))]
proportions_manual <- proportions_manual |>
rename("prop"=proportions_prop)
correspondence_table <- correspondence_table |>
anti_join(proportions_manual,by=c(original_geo,new_geo)) |>
bind_rows(proportions_manual)
}
year_num <- as.double(year)
results <-       original_data |>
rename(!!"Value":=any_of(c(values_col)))        |>
left_join(correspondence_table,by=original_geo) |>
select(-any_of(c(original_geo)))                |>
group_by(across(c(new_geo,grouping_col)))        |>
summarise(Value=sum(.data$Value*.data$prop,na.rm = TRUE),.groups = "drop") |>
rename(!!values_col:="Value")
original_data |>
rename(!!"Value":=any_of(c(values_col)))
values_col
original_geo
correspondence_table
original_geo = "SA2_NAME_2021"
original_data |>
rename(!!"Value":=any_of(c(values_col)))        |>
left_join(correspondence_table,by=original_geo)
original_data |>
rename(!!"Value":=any_of(c(values_col)))        |>
left_join(correspondence_table,by=original_geo)
original_geo
original_data
original_data
original_data = chileans_sa2
correspondence_table <- list_structure(year=year) |>
select(any_of(c("id",original_geo,new_geo)))
proportions_table <-   list_proportions(original_geo) |>
collect()  |>
select("id","geo_col","prop") |>
rename(!!original_geo := "geo_col")
correspondence_table <- correspondence_table |>
left_join(proportions_table,by=c("id",original_geo)) |>
group_by(across(c(original_geo,new_geo))) |>
summarise(across(c("prop"), ~ sum(.x,na.rm=TRUE)),.groups = "drop")
correspondence_table <- correspondence_table |>
left_join(proportions_table,by=c("id",original_geo)) |>
group_by(across(c(original_geo,new_geo))) |>
summarise(across(c("prop"), ~ sum(.x,na.rm=TRUE)),.groups = "drop")
if(!is.null(proportions_manual)){
proportions_prop <- colnames(proportions_manual)[!(colnames(proportions_manual) %in% c(original_geo,new_geo))]
proportions_manual <- proportions_manual |>
rename("prop"=proportions_prop)
correspondence_table <- correspondence_table |>
anti_join(proportions_manual,by=c(original_geo,new_geo)) |>
bind_rows(proportions_manual)
}
year_num <- as.double(year)
results <-       original_data |>
rename(!!"Value":=any_of(c(values_col)))        |>
left_join(correspondence_table,by=original_geo) |>
select(-any_of(c(original_geo)))                |>
group_by(across(c(new_geo,grouping_col)))        |>
summarise(Value=sum(.data$Value*.data$prop,na.rm = TRUE),.groups = "drop") |>
rename(!!values_col:="Value")
original_data
greater_sydney <- list_structure(year=2021,filters=list(GCCSA_NAME_2021="Greater Sydney"))
#use_cache option stores the results/reuses pre-processed results
sydney_area <- get_map(filter_table = greater_sydney,
year=2021,
aggregation = "GCCSA_NAME_2021",
use_cache = TRUE)
#outline
# all suburbs starting wit A
suburbs_a_filter <- greater_sydney |>
filter(str_detect(SAL_NAME_2021,"^A"))
suburbs_a  <- get_map(filter_table = suburbs_a_filter,
year=2021,
aggregation = "SAL_NAME_2021") |>
mutate(border="orange",fill="orange")
ggplot() +
geom_sf(data=greater_sydney_outline,fill="white",colour="black")+
geom_sf(data=suburbs_a,fill="orange") +
labs(title="Suburbs starting with A - Sydney") +
theme_void()
#use_cache option stores the results/reuses pre-processed results
sydney_area <- get_map(filter_table = greater_sydney,
year=2021,
aggregation = "GCCSA_NAME_2021",
use_cache = TRUE)
# all suburbs starting wit A
suburbs_a_filter <- greater_sydney |>
filter(str_detect(SAL_NAME_2021,"^A"))
suburbs_a  <- get_map(filter_table = suburbs_a_filter,
year=2021,
aggregation = "SAL_NAME_2021") |>
mutate(border="orange",fill="orange")
suburbs_a  <- get_map(filter_table = suburbs_a_filter,
year=2021,
aggregation = "SAL_NAME_2021") |>
mutate(border="orange",fill="orange")
ggplot() +
geom_sf(data=sydney_area,fill="white",colour="black")+
geom_sf(data=suburbs_a,fill="orange") +
labs(title="Suburbs starting with A - Sydney") +
theme_void()
attr <- list_structure(year=2021,filters=list(GCCSA_NAME_2021=c("Brisbane"))) |>
distinct(SA1_CODE_2021)
chileans_sa2 <- auscensus::get_census_summary(table_number= "09",
selected_years = "2021",
geo_structure = "SA2",
geo_unit_codes =     attr$SA1_CODE_2021,
attribute = list(Chileans=c("Persons_chile_total")))
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_NAME_2021",
new_geo      = "CED_NAME_2021",
year=2021)
chileans_sa2
chileans_sa2 <- auscensus::get_census_summary(table_number= "09",
selected_years = "2021",
geo_structure = "SA2",
geo_unit_codes =     attr$SA2_CODE_2021,
attribute = list(Chileans=c("Persons_chile_total")))
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_NAME_2021",
new_geo      = "CED_NAME_2021",
year=2021)
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_CODE_2021",
new_geo      = "CED_NAME_2021",
year=2021)
chileans_sa2
chileans_sa2 <- auscensus::get_census_summary(table_number= "09",
selected_years = "2021",
geo_structure = "SA2",
geo_unit_codes =     attr$SA2_CODE_2021,
attribute = list(Chileans=c("Persons_chile_total"))) |>
rename("Census_Code"="SA_CODE_2021")
chileans_sa2 <- auscensus::get_census_summary(table_number= "09",
selected_years = "2021",
geo_structure = "SA2",
geo_unit_codes =     attr$SA2_CODE_2021,
attribute = list(Chileans=c("Persons_chile_total"))) |>
rename("SA_CODE_2021"="Census_Code")
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_CODE_2021",
new_geo      = "CED_NAME_2021",
year=2021)
chileans_sa2
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_CODE_2021",
new_geo      = "CED_NAME_2021",
aggregation = c("Year","Attribute"),
year=2021)
?geo_aggregate
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_CODE_2021",
new_geo      = "CED_NAME_2021",
grouping_col =   c("Year","Attribute"),
year=2021)
chileans_sa2 <- auscensus::get_census_summary(table_number= "09",
selected_years = "2021",
geo_structure = "SA2",
geo_unit_codes =     attr$SA2_CODE_2021,
attribute = list(Chileans=c("Persons_chile_total"))) |>
rename("SA2_CODE_2021"="Census_Code")
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_CODE_2021",
new_geo      = "CED_NAME_2021",
grouping_col =   c("Year","Attribute"),
year=2021)
chileans
chileans_sa2 <- auscensus::get_census_summary(table_number= "09",
selected_years = "2021",
geo_structure = "SA2",
geo_unit_codes =     attr$SA2_CODE_2021,
attribute = list(Chileans=c("Persons_chile_total"))) |>
rename("SA2_CODE_2021"="Census_Code")
chileans_sa2
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_CODE_2021",
new_geo      = "CED_NAME_2021",
grouping_col =   c("Year","Attribute"),
year=2021)
chileans
brisbane_ced |>
left_join(chileans,by=c("CED_NAME_2021"="Unit")) |>
ggplot(aes(fill=Value,colour=Value)) +
geom_sf() +
scale_fill_continuous()+
labs(title="Chileans in Bribane's Federal Electorates") +
theme_void()
chileans
# please note these Electoral divisions are not built from SA2s - proportional allocation will result in factional numbers
chileans <- geo_aggregate(original_data = chileans_sa2,
values_col = "Value",
original_geo = "SA2_CODE_2021",
new_geo      = "CED_NAME_2021",
grouping_col =   c("Year","Attribute"),
year=2021) |>
rename("Unit"="CED_NAME_2021")
brisbane_ced |>
left_join(chileans,by=c("CED_NAME_2021"="Unit")) |>
ggplot(aes(fill=Value,colour=Value)) +
geom_sf() +
scale_fill_continuous()+
labs(title="Chileans in Bribane's Federal Electorates") +
theme_void()
library(aussiemaps)
### This file intends to be a shortcut to install and use {trackdown}, an R package to use Google Docs to edit the "narrative" part of a RMD file
### {trackdown} can be downloaded from CRAN
### This file is not intended to be run as one piece!
library(tidyverse)
library(fs)
library(here)
## Settings #####
gdrive_path <- "trackdown"              # the folder on google drive
files <- fs::dir_info(here("precompile")) %>% filter(str_detect(path,"\\.Rmd")) %>% pull(path)
for(file in files)
trackdown::upload_file(file, gpath="aussiemaps",hide_code=TRUE)
trackdown::download_file(file,gpath="aussiemaps")
usethis::use_testthat()
usethis::use_testthat(3)
usethis::use_test()
usethis::use_test()
usethis::use_test()
library(knitr)
library(here)
library(fs)
library(stringr)
library(dplyr)
orig_folder <- here("precompile")
vignettes_folder <- here("vignettes")
vignettes <- dir_ls(orig_folder,regexp=".Rmd") |> str_remove_all(str_c(orig_folder,"/"))
for(vig in vignettes){
knit(here(orig_folder,vig), here(vignettes_folder,vig))
}
lwgeom::lwgeom_extSoftVersion()
?str_flatten_comma
remove.packages("aussiemaps.data")
library(aussiemaps)
pkgdown::build_site()
library(knitr)
library(here)
library(fs)
library(stringr)
library(dplyr)
orig_folder <- here("precompile")
vignettes_folder <- here("vignettes")
vignettes <- dir_ls(orig_folder,regexp=".Rmd") |> str_remove_all(str_c(orig_folder,"/"))
for(vig in vignettes){
knit(here(orig_folder,vig), here(vignettes_folder,vig))
}
pkgdown::build_articles()
pkgdown::build_home()
pngs <-  dir_ls(vignettes_folder,regexp=".png")
article_dir<-here("docs","articles")
#dir_create(article_img)
file_copy(pngs, article_dir,overwrite = TRUE)
article_html <- dir_ls(article_dir,regexp="html")
for(article in article_html){
file <- tibble(orig=readLines(article))
file <-file |> mutate(new=if_else(str_detect(orig,"img src=\"articles/"),
str_replace(orig,"img src=\"articles/","img src=\"https://carlosyanez.github.io/aussiemaps/articles/"),
orig))
write(file$new,article)
}
pkgdown::build_articles()
pkgdown::build_home_index()
pkgdown::build_home()
pkgdown::build_site()
pkgdown::preview_page('articles/aussiemaps.html')
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_home()
pngs <-  dir_ls(vignettes_folder,regexp=".png")
pngs
article_dir<-here("docs","articles")
#dir_create(article_img)
file_copy(pngs, article_dir,overwrite = TRUE)
article_html <- dir_ls(article_dir,regexp="html")
for(article in article_html){
file <- tibble(orig=readLines(article))
file <-file |> mutate(new=if_else(str_detect(orig,"img src=\"articles/"),
str_replace(orig,"img src=\"articles/","img src=\"https://carlosyanez.github.io/aussiemaps/articles/"),
orig))
write(file$new,article)
}
pkgdown::build_home()
pkgdown::build_home_index()
pkgdown::build_home_index()
library(aussiemaps)
a <- data_maps_info()
View(a)
sf::st_layers("C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg")
rgdal::ogrListLayers("C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg")
rgdal::ogrListLayers("C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg")[1]
sf::st_layers("C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg")
a<-sf::st_layers("C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg")
sf::st_layers("C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg")$name
sf::st_layers("C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg")$name[1]
aussimaps_file <- "C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg"
file_name <- load_aussiemaps(aussiemaps_file)
source("~/GitHub/aussiemaps/R/internal.R")
file_name <- load_aussiemaps(aussiemaps_file)
library(tidyverse)
library(fs)
library(sf)
library(arrow)
aussiemaps_file <- "C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg"
file_name <- load_aussiemaps(aussiemaps_file)
library(piggyback)
aussiemaps_file <- "C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg"
aussiemaps_file
file_name <- load_aussiemaps(aussiemaps_file)
file_name
file_name <- "C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Western.Australia.gpkg"
file_copy(file_name,temp_gpkg,overwrite=TRUE)
data_layer <- st_layers(temp_gpkg)$name[1]
temp_gpkg <- path(find_maps_cache(),"temp.gpkg")
file_copy(file_name,temp_gpkg,overwrite=TRUE)
file_name <- "C:/Users/carlo/OneDrive/Documents/.aussiemaps_cache/2016_Tasmania.gpkg"
file_copy(file_name,temp_gpkg,overwrite=TRUE)
data_layer <- st_layers(temp_gpkg)$name[1]
st_layers(temp_gpkg)
st_layers
?st_layers
data_layer <- st_layers(temp_gpkg)$name[1]
data_layer <- st_layers(file_name)$name[1]
data_layer
libray(aussiemaps)
library(aussiemaps)
source("~/GitHub/aussiemaps/R/internal.R")
source("~/GitHub/aussiemaps/R/get_map.R")
library(aussiemaps)
library(arrow)
library(piggyback)
library(tidyverse)
library(fs)
library(sf)
preston <- get_map(filters=list(SSC_NAME_2016=c("Preston")),
year=2016,
aggregation = c("SSC_NAME_2016"))
library(lwgeom)
source("~/GitHub/aussiemaps/R/get_map.R")
preston <- get_map(filters=list(SSC_NAME_2016=c("Preston")),
year=2016,
aggregation = c("SSC_NAME_2016"))
library(digest)
preston <- get_map(filters=list(SSC_NAME_2016=c("Preston")),
year=2016,
aggregation = c("SSC_NAME_2016"))
library(lubridate)
preston <- get_map(filters=list(SSC_NAME_2016=c("Preston")),
year=2016,
aggregation = c("SSC_NAME_2016"))
library(smoothr)
preston <- get_map(filters=list(SSC_NAME_2016=c("Preston")),
year=2016,
aggregation = c("SSC_NAME_2016"))
#library(aussiemaps)
#library(arrow)
#library(piggyback)
#library(tidyverse)
#library(fs)
#library(sf)
#library(lwgeom)
#library(digest)
#library(lubridate)
#library(smoothr)
library(units)
preston <- get_map(filters=list(SSC_NAME_2016=c("Preston")),
year=2016,
aggregation = c("SSC_NAME_2016"))
install.packages("covr")
usethis::use_github_action_check_standard()
